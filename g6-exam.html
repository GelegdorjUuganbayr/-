<!doctype html>
<html lang="mn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CTP –®–∞–ª–≥–∞–ª—Ç (Template ¬∑ Auto Score)</title>
  <style>
    :root{
      --bg:#0b1220;
      --card:#0f172a;
      --muted:#94a3b8;
      --text:#e5e7eb;
      --accent:#38bdf8;
      --good:#22c55e;
      --warn:#f59e0b;
      --bad:#ef4444;
      --line: rgba(148,163,184,.18);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1100px 600px at 20% -10%, rgba(56,189,248,.25), transparent 60%),
                  radial-gradient(900px 500px at 90% 0%, rgba(34,197,94,.18), transparent 55%),
                  var(--bg);
      color:var(--text);
    }
    header{
      position: sticky; top:0; z-index:10;
      background: linear-gradient(180deg, rgba(15,23,42,.95), rgba(15,23,42,.75));
      border-bottom: 1px solid var(--line);
      backdrop-filter: blur(10px);
    }
    .wrap{max-width:980px;margin:0 auto;padding:14px 14px}
    .top{display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap;}
    .brand{display:flex; flex-direction:column; gap:4px}
    .brand h1{margin:0;font-size:18px; letter-spacing:.2px}
    .brand .sub{font-size:12px;color:var(--muted)}
    .btns{display:flex; gap:8px; flex-wrap:wrap}
    button{
      border: 1px solid var(--line);
      background: rgba(2,6,23,.35);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      cursor:pointer;
      font-weight:600;
      font-size: 13px;
    }
    button.primary{
      background: rgba(56,189,248,.18);
      border-color: rgba(56,189,248,.45);
    }
    button.good{
      background: rgba(34,197,94,.18);
      border-color: rgba(34,197,94,.45);
    }
    button:disabled{opacity:.55; cursor:not-allowed}
    main{padding:16px 14px 28px}
    .grid{
      max-width:980px; margin:0 auto;
      display:grid; gap:14px;
      grid-template-columns: 1fr;
    }
    @media (min-width: 920px){
      .grid{grid-template-columns: 1.2fr .8fr; align-items:start;}
    }
    .card{
      background: linear-gradient(180deg, rgba(15,23,42,.92), rgba(2,6,23,.55));
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 14px;
      box-shadow: 0 12px 30px rgba(0,0,0,.25);
    }
    .card h2{margin:0 0 10px 0;font-size: 15px;letter-spacing:.2px;}
    .muted{color:var(--muted); font-size:12px; line-height:1.4}
    .row{display:flex; gap:10px; flex-wrap:wrap}
    label{font-size:13px}
    input[type="text"], textarea, input[type="date"]{
      width:100%;
      padding: 10px 12px;
      border-radius: 12px;
      border:1px solid var(--line);
      background: rgba(2,6,23,.35);
      color: var(--text);
      outline:none;
    }
    textarea{min-height: 86px; resize: vertical}
    .infoRow{display:grid; gap:10px; grid-template-columns: 1fr;}
    @media (min-width: 520px){
      .infoRow{grid-template-columns: 1.3fr .7fr .7fr}
    }
    .q{
      border-top:1px solid var(--line);
      padding-top:12px; margin-top:12px;
    }
    .q:first-child{border-top:none; padding-top:0; margin-top:0}
    .qtitle{
      font-weight:700;
      font-size: 13.5px;
      margin-bottom: 10px;
      line-height:1.35;
    }
    .opts{display:grid; gap:8px; grid-template-columns: 1fr;}
    @media (min-width: 520px){
      .opts{grid-template-columns: 1fr 1fr}
    }
    .opt{
      display:flex; gap:10px; align-items:flex-start;
      padding: 10px 10px;
      border: 1px solid var(--line);
      border-radius: 14px;
      background: rgba(2,6,23,.26);
    }
    .opt input{transform: translateY(2px)}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px; border-radius: 999px;
      border:1px solid var(--line);
      background: rgba(2,6,23,.28);
      font-size:12px; color: var(--muted);
    }
    .pill strong{color:var(--text)}
    .notice{
      border-left: 3px solid rgba(56,189,248,.7);
      padding: 10px 12px;
      background: rgba(56,189,248,.08);
      border-radius: 12px;
      margin-top: 10px;
      font-size: 12.5px;
      color: var(--text);
    }
    .scoreBox{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
      margin-top: 10px;
    }
    .list{display:flex; flex-direction:column; gap:10px; max-height: 62vh; overflow:auto; padding-right: 6px;}
    .item{border: 1px solid var(--line); background: rgba(2,6,23,.28); border-radius: 14px; padding: 10px;}
    .itemTop{display:flex; align-items:center; justify-content:space-between; gap:8px; flex-wrap:wrap}
    .itemName{font-weight:800}
    .mini{font-size:12px; color: var(--muted)}
    .ans{margin-top: 8px; display:grid; gap:8px;}
    .ans .box{
      border:1px dashed rgba(148,163,184,.25);
      border-radius: 12px;
      padding: 8px 10px;
      background: rgba(2,6,23,.18);
      font-size: 12.5px;
      color: var(--text);
      white-space: pre-wrap;
    }
    .tag{font-size:12px; padding:6px 10px; border-radius:999px; border:1px solid var(--line)}
    .tag.good{border-color: rgba(34,197,94,.55); background: rgba(34,197,94,.12)}
    .tag.warn{border-color: rgba(245,158,11,.55); background: rgba(245,158,11,.12)}
    .tag.bad{border-color: rgba(239,68,68,.55); background: rgba(239,68,68,.12)}
    .hidden{display:none !important}
  </style>
</head>

<body>
<header>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <h1 id="hdrTitle"></h1>
        <div class="sub" id="hdrSub"></div>
      </div>
      <div class="btns">
        <button id="btnExam" class="primary" type="button">üìù –®–∞–ª–≥–∞–ª—Ç</button>
        <button id="btnPoints" type="button">üèÅ Points</button>
        <button id="btnNew" class="good" type="button">‚ûï ”®”©—Ä —Ö“Ø“Ø—Ö—ç–¥ —à–∞–ª–≥–∞–ª—Ç ”©–≥”©—Ö</button>
      </div>
    </div>
  </div>
</header>

<main>
  <div class="grid">
    <!-- EXAM -->
    <section id="examView" class="card">
      <h2>–®–∞–ª–≥–∞–ª—Ç –±”©–≥–ª”©—Ö</h2>
      <div class="muted" id="instructions"></div>

      <div class="notice">
        ‚úÖ –ù—ç—Ä –∑–∞–∞–≤–∞–ª. ‚úÖ –ë“Ø—Ö —Ç–µ—Å—Ç–∏–π–≥ –±”©–≥–ª”©”©–¥ ‚ÄúSubmit‚Äù –¥–∞—Ä–Ω–∞. –î–∞—Ä–∞–∞ –Ω—å ‚Äú”®”©—Ä —Ö“Ø“Ø—Ö—ç–¥‚Äù –¥–∞—Ä–∂ –¥–∞—Ä–∞–∞–≥–∏–π–Ω —Ö“Ø“Ø—Ö—ç–¥ ”©–≥–Ω”©.
      </div>

      <div style="margin-top:12px" class="infoRow">
        <div>
          <label><strong>–ù—ç—Ä *</strong></label>
          <input id="studentName" type="text" placeholder="–ñ–∏—à—ç—ç: –ë–∞—Ç-–≠—Ä–¥—ç–Ω—ç" required />
        </div>
        <div>
          <label><strong>–ê–Ω–≥–∏</strong></label>
          <input id="studentClass" type="text" placeholder="–ñ–∏—à—ç—ç: 6A" />
        </div>
        <div>
          <label><strong>–û–≥–Ω–æ–æ</strong></label>
          <input id="examDate" type="date" />
        </div>
      </div>

      <div style="margin-top:12px" class="row">
        <span class="pill">–¢–µ—Å—Ç –±”©–≥–ª”©—Å”©–Ω: <strong id="filledCount">0</strong>/<strong id="totalQs">0</strong></span>
        <span class="pill">–°“Ø“Ø–ª–¥ —Ö–∞–¥–≥–∞–ª—Å–∞–Ω: <strong id="lastSaved">-</strong></span>
      </div>

      <form id="examForm" novalidate style="margin-top:10px">
        <div id="questions"></div>

        <div class="q" id="openSection">
          <div class="qtitle" id="openTitle">B. ‚úçÔ∏è –ë–∏—á–∏—Ö</div>

          <label><strong id="openQ1Label"></strong></label>
          <textarea id="open1" placeholder="–≠–Ω–¥ –±–∏—á–Ω—ç..."></textarea>

          <div style="height:10px"></div>

          <label><strong id="openQ2Label"></strong></label>
          <textarea id="open2" placeholder="–≠–Ω–¥ –±–∏—á–Ω—ç..."></textarea>
        </div>

        <div class="scoreBox">
          <button id="btnSubmit" class="primary" type="submit">‚úÖ Submit</button>
          <span class="muted">Submit –¥–∞—Ä–º–∞–≥—Ü —Ö–∞–¥–≥–∞–ª–Ω–∞. (–û–Ω–æ–æ —Å—É—Ä–∞–≥—á–∏–¥ —Ö–∞—Ä–∞–≥–¥–∞—Ö–≥“Ø–π)</span>
        </div>
      </form>
    </section>

    <!-- POINTS -->
    <section id="pointsView" class="card hidden">
      <h2>üèÅ Points (–ë–∞–≥—à)</h2>
      <div class="muted">–≠–Ω–¥ –Ω—ç–≥ —Ç”©—Ö”©”©—Ä”©–º–∂ –¥—ç—ç—Ä ”©–≥—Å”©–Ω –±“Ø—Ö —Ö“Ø“Ø—Ö–¥–∏–π–Ω “Ø—Ä –¥“Ø–Ω —Ö–∞–¥–≥–∞–ª–∞–≥–¥–∞–Ω–∞.</div>

      <div style="margin-top:10px" class="row">
        <span class="pill">–ù–∏–π—Ç –±“Ø—Ä—Ç–≥—ç–ª: <strong id="totalCount">0</strong></span>
        <span class="pill">–î—É–Ω–¥–∞–∂ –æ–Ω–æ–æ: <strong id="avgScore">-</strong></span>
      </div>

      <div style="margin-top:12px" class="list" id="resultsList"></div>
    </section>
  </div>
</main>

<script>
/* ============================================================
   ‚úÖ CONFIG (TEMPLATE) ‚Äî –ó”®–í–•”®–ù –≠–ù–≠ –•–≠–°–ì–ò–ô–ì –°–û–õ–ò–û–î –õ –ë–û–õ–ù–û
   - –•—ç–¥—ç–Ω —á —Ç–µ—Å—Ç –Ω—ç–º—Å—ç–Ω –∞–≤—Ç–æ–º–∞—Ç–∞–∞—Ä –∞–∂–∏–ª–ª–∞–Ω–∞
   - answerKey-–¥ –∑”©–≤—Ö”©–Ω –±–∞–π–≥–∞–∞ –∞—Å—É—É–ª—Ç—ã–Ω n-–¥ —Ç–∞–∞—Ä—É—É–ª–∂ ”©–≥–Ω”©
============================================================ */
const EXAM = {
  examId: "grade6_unit1_flowchart_v1",
  headerTitle: "6-—Ä –∞–Ω–≥–∏ ‚Äì Unit 1: Computational Thinking & Programming",
  headerSub: "Front-end auto score ¬∑ 1 —Ç”©—Ö”©”©—Ä”©–º–∂ –¥—ç—ç—Ä –æ–ª–æ–Ω —Ö“Ø“Ø—Ö—ç–¥ ¬∑ localStorage —Ö–∞–¥–≥–∞–ª–∞–ª—Ç",
  instructionsText: "–ó–∞–∞–≤–∞—Ä: –¢–µ—Å—Ç (–Ω—ç–≥ –∑”©–≤ —Ö–∞—Ä–∏—É–ª—Ç—Ç–∞–π). –î–∞—Ä–∞–∞ –Ω—å 2 –±–∏—á–∏—Ö –¥–∞–∞–ª–≥–∞–≤–∞—Ä –≥“Ø–π—Ü—ç—Ç–≥—ç–Ω—ç.",
  teacherPin: "9801",

  openTitle: "B. ‚úçÔ∏è –ë–∏—á–∏—Ö (2)",
  openQ1: "17) Flowchart-–∏–π–Ω 4 —Ö—ç–ª–±—ç—Ä–∏–π–Ω –Ω—ç—Ä –±–∞ “Ø“Ø—Ä–≥–∏–π–≥ —Ç–∞–π–ª–±–∞—Ä–ª–∞.",
  openQ2: "18) –ü—Ä–æ–≥—Ä–∞–º –±–∏—á—Å—ç–Ω–∏–π –¥–∞—Ä–∞–∞ —è–∞–≥–∞–∞–¥ systematic testing —Ö–∏–π—Ö —à–∞–∞—Ä–¥–ª–∞–≥–∞—Ç–∞–π –≤—ç?",

  questions: [
    {n:1, t:"Flowchart –≥—ç–∂ —é—É –≤—ç?", o:{A:"”®–≥”©–≥–¥–ª–∏–π–Ω —Å–∞–Ω",B:"–ê–ª–≥–æ—Ä–∏—Ç–º—ã–≥ –¥“Ø—Ä—Å—ç—ç—Ä “Ø–∑“Ø“Ø–ª—Å—ç–Ω –¥–∏–∞–≥—Ä–∞–º",C:"–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å",D:"–ö–æ–¥—ã–Ω –∞–ª–¥–∞–∞"}},
    {n:2, t:"Start/End —Ö—ç–ª–±—ç—Ä:", o:{A:"–î”©—Ä–≤”©–ª–∂–∏–Ω",B:"–ó—É—É–≤–∞–Ω",C:"–ê–ª–º–∞–∑",D:"–ü–∞—Ä–∞–ª–ª–µ–ª–æ–≥—Ä–∞–º–º"}},
    {n:3, t:"Process —è–º–∞—Ä “Ø“Ø—Ä—ç–≥—Ç—ç–π –≤—ç?", o:{A:"–°–æ–Ω–≥–æ–ª—Ç",B:"“Æ–π–ª–¥—ç–ª",C:"–≠—Ö–ª—ç–ª/—Ç”©–≥—Å–≥”©–ª",D:"–û—Ä–æ–ª—Ç/–≥–∞—Ä–∞–ª—Ç"}},
    {n:4, t:"Input/Output —Ö—ç–ª–±—ç—Ä:", o:{A:"–ü–∞—Ä–∞–ª–ª–µ–ª–æ–≥—Ä–∞–º–º",B:"–ê–ª–º–∞–∑",C:"–ó—É—É–≤–∞–Ω",D:"–î”©—Ä–≤”©–ª–∂–∏–Ω"}},
    {n:5, t:"Decision –∞—Å—É—É–ª—Ç:", o:{A:"–£—Ä—Ç —Ç–∞–π–ª–±–∞—Ä",B:"–¢–∏–π–º / “Æ–≥“Ø–π",C:"–¢–æ–æ",D:"–¢–µ–∫—Å—Ç"}},
    {n:6, t:"Sequence –≥—ç–¥—ç–≥ –Ω—å:", o:{A:"–î–∞–≤—Ç–∞–ª—Ç",B:"–ó”©–≤ –¥–∞—Ä–∞–∞–ª–∞–ª",C:"–•–∞–¥–≥–∞–ª–∞–ª—Ç",D:"–°–æ–Ω–≥–æ–ª—Ç"}},
    {n:7, t:"Iteration –≥—ç–¥—ç–≥ –Ω—å:", o:{A:"–£—Å—Ç–≥–∞—Ö",B:"–î–∞–≤—Ç–∞—Ö",C:"–°–æ–Ω–≥–æ—Ö",D:"–•–∞–¥–≥–∞–ª–∞—Ö"}},
    {n:8, t:"‚Äúrepeat‚Äù –±–ª–æ–∫:", o:{A:"Selection",B:"Iteration",C:"Input",D:"Output"}},
    {n:9, t:"Variable –≥—ç–∂:", o:{A:"–¢–æ–≥–ª–æ–æ–º",B:"”®–≥”©–≥–¥”©–ª —Ö–∞–¥–≥–∞–ª–∞—Ö —Å–∞–≤",C:"–°—É–º",D:"–î“Ø—Ä—Å"}},
    {n:10, t:"Integer –∞–ª—å –Ω—å –≤—ç?", o:{A:"3.14",B:'"7"',C:"7",D:"seven"}},
    {n:11, t:"Character –∞–ª—å –Ω—å –≤—ç?", o:{A:'"Hello"',B:"'A'",C:"12",D:"2.5"}},
    {n:12, t:"Condition –∞–ª—å –æ–π–ª–≥–æ–ª—Ç –≤—ç?", o:{A:"Selection",B:"Database",C:"Spreadsheet",D:"Prototype"}},
    {n:13, t:"Success criteria:", o:{A:"–ê–ª–¥–∞–∞ –æ–ª–æ—Ö",B:"–ê–º–∂–∏–ª—Ç—ã–Ω —à–∞–ª–≥—É—É—Ä",C:"–ò–Ω—Ç–µ—Ä–Ω—ç—Ç",D:"–•—É–≤—å—Å–∞–≥—á"}},
    {n:14, t:"Systematic testing:", o:{A:"–°–∞–Ω–∞–º—Å–∞—Ä–≥“Ø–π",B:"–¢”©–ª”©–≤–ª”©–≥”©”©—Ç—ç–π",C:"–ù—ç–≥ —É–¥–∞–∞",D:"–ë–∞–≥—à —à–∞–ª–≥–∞—Ö"}},
    {n:15, t:"Flowchart —Ö–∞–∞–Ω–∞–∞—Å —ç—Ö—ç–ª–¥—ç–≥ –≤—ç?", o:{A:"End",B:"Start",C:"–î—É—Ä—ã–Ω",D:"Decision"}},
    {n:16, t:"Selection –∏—Ö—ç–≤—á–ª—ç–Ω:", o:{A:"IF‚ÄìTHEN‚ÄìELSE",B:"REPEAT",C:"VARIABLE",D:"INPUT"}},
  ],

  answerKey: {
    1:"B",2:"B",3:"B",4:"A",5:"B",6:"B",7:"B",8:"B",
    9:"B",10:"C",11:"B",12:"A",13:"B",14:"B",15:"B",16:"A"
  }
};
/* ===================== END CONFIG ===================== */

const OUT_OF = EXAM.questions.length;
const STORAGE_KEY = `ctp_exam_results_${EXAM.examId}`;

function loadResults(){
  try{ return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]"); }
  catch(e){ return []; }
}
function saveResults(arr){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
}

const examView = document.getElementById("examView");
const pointsView = document.getElementById("pointsView");

const btnExam = document.getElementById("btnExam");
const btnPoints = document.getElementById("btnPoints");
const btnNew = document.getElementById("btnNew");

const questionsEl = document.getElementById("questions");
const examForm = document.getElementById("examForm");

const studentName = document.getElementById("studentName");
const studentClass = document.getElementById("studentClass");
const examDate = document.getElementById("examDate");

const filledCount = document.getElementById("filledCount");
const totalQs = document.getElementById("totalQs");
const lastSaved = document.getElementById("lastSaved");

const totalCount = document.getElementById("totalCount");
const avgScore = document.getElementById("avgScore");
const resultsList = document.getElementById("resultsList");

function escapeHtml(s){
  return String(s)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

// Apply texts
document.getElementById("hdrTitle").textContent = EXAM.headerTitle;
document.getElementById("hdrSub").textContent = EXAM.headerSub || "";
document.getElementById("instructions").textContent = EXAM.instructionsText || "";
document.getElementById("openTitle").textContent = EXAM.openTitle || "B. ‚úçÔ∏è –ë–∏—á–∏—Ö";
document.getElementById("openQ1Label").textContent = EXAM.openQ1 || "–ë–∏—á–∏—Ö 1";
document.getElementById("openQ2Label").textContent = EXAM.openQ2 || "–ë–∏—á–∏—Ö 2";
totalQs.textContent = OUT_OF;

function renderQuestions(){
  questionsEl.innerHTML = "";
  for(const q of EXAM.questions){
    const wrap = document.createElement("div");
    wrap.className = "q";
    wrap.innerHTML = `
      <div class="qtitle">${q.n}. ${escapeHtml(q.t)}</div>
      <div class="opts">
        ${Object.entries(q.o).map(([k,v]) => `
          <label class="opt">
            <input type="radio" name="q${q.n}" value="${k}" />
            <div><strong>${k})</strong> ${escapeHtml(v)}</div>
          </label>
        `).join("")}
      </div>
    `;
    questionsEl.appendChild(wrap);
  }
}

function getSelectedAnswers(){
  const answers = {};
  for(const q of EXAM.questions){
    const checked = document.querySelector(`input[name="q${q.n}"]:checked`);
    answers[q.n] = checked ? checked.value : "";
  }
  return answers;
}

function computeScore(ans){
  let score = 0;
  for(const q of EXAM.questions){
    const key = EXAM.answerKey[q.n];
    if(key && ans[q.n] === key) score++;
  }
  return score;
}

function updateProgress(){
  const ans = getSelectedAnswers();
  const filled = Object.values(ans).filter(v=>v).length;
  filledCount.textContent = filled;
}

function showExam(){
  examView.classList.remove("hidden");
  pointsView.classList.add("hidden");
}
function showPoints(){
  examView.classList.add("hidden");
  pointsView.classList.remove("hidden");
  renderPoints();
}

function resetForm(){
  examForm.reset();
  studentName.value = "";
  studentClass.value = "";
  document.getElementById("open1").value = "";
  document.getElementById("open2").value = "";
  lastSaved.textContent = "-";
  updateProgress();
  studentName.focus();
}

function saveAttempt(){
  const name = studentName.value.trim();
  if(!name){
    alert("–ù—ç—Ä –∑–∞–∞–≤–∞–ª –±”©–≥–ª”©–Ω”©!");
    studentName.focus();
    return null;
  }

  const answers = getSelectedAnswers();

  // ‚úÖ Missing check = –∑”©–≤—Ö”©–Ω EXAM.questions –¥—ç—ç—Ä “Ø–Ω–¥—ç—Å–ª—ç–Ω—ç
  const missing = [];
  for(const q of EXAM.questions){
    if(!answers[q.n]) missing.push(q.n);
  }
  if(missing.length){
    alert("–î–∞—Ä–∞–∞—Ö –∞—Å—É—É–ª—Ç—É—É–¥ –¥—É—Ç—É—É –±–∞–π–Ω–∞: " + missing.join(", "));
    return null;
  }

  const score = computeScore(answers);
  const open1 = document.getElementById("open1").value.trim();
  const open2 = document.getElementById("open2").value.trim();
  const cls = studentClass.value.trim();
  const date = examDate.value || new Date().toISOString().slice(0,10);

  const record = {
    id: crypto.randomUUID ? crypto.randomUUID() : String(Date.now()) + Math.random().toString(16).slice(2),
    name,
    class: cls,
    date,
    score,
    outOf: OUT_OF,
    answers,
    open1,
    open2,
    ts: Date.now()
  };

  const all = loadResults();
  all.push(record);
  saveResults(all);

  lastSaved.textContent = "‚úî";
  return record;
}

function scoreTag(score){
  const ratio = score / OUT_OF;
  if(ratio >= 0.8) return `<span class="tag good">–°–∞–π–Ω</span>`;
  if(ratio >= 0.5) return `<span class="tag warn">–î—É–Ω–¥</span>`;
  return `<span class="tag bad">–°–∞–π–∂—Ä—É—É–ª–∞—Ö</span>`;
}

function renderPoints(){
  const all = loadResults().sort((a,b)=>b.ts-a.ts);
  totalCount.textContent = all.length;

  if(all.length){
    const avg = all.reduce((s,x)=>s+x.score,0) / all.length;
    avgScore.textContent = avg.toFixed(2) + `/${OUT_OF}`;
  } else {
    avgScore.textContent = "-";
  }

  resultsList.innerHTML = "";
  if(!all.length){
    resultsList.innerHTML = `<div class="muted">–û–¥–æ–æ–≥–æ–æ—Ä —Ö–∞–¥–≥–∞–ª—Å–∞–Ω “Ø—Ä –¥“Ø–Ω –∞–ª–≥–∞ –±–∞–π–Ω–∞.</div>`;
    return;
  }

  for(const r of all){
    const item = document.createElement("div");
    item.className = "item";
    item.innerHTML = `
      <div class="itemTop">
        <div>
          <div class="itemName">${escapeHtml(r.name)} ${r.class ? `<span class="mini">(${escapeHtml(r.class)})</span>` : ""}</div>
          <div class="mini">–û–≥–Ω–æ–æ: ${escapeHtml(r.date)} ¬∑ –ë“Ø—Ä—Ç–≥—ç—Å—ç–Ω: ${new Date(r.ts).toLocaleString()}</div>
        </div>
        <div style="display:flex; gap:8px; align-items:center">
          <div style="font-size:26px;font-weight:900">${r.score}/${r.outOf}</div>
          ${scoreTag(r.score)}
        </div>
      </div>
      <div class="ans">
        <div class="box"><strong>–ë–∏—á–∏—Ö 1:</strong>\n${escapeHtml(r.open1 || "(—Ö–æ–æ—Å–æ–Ω)")}</div>
        <div class="box"><strong>–ë–∏—á–∏—Ö 2:</strong>\n${escapeHtml(r.open2 || "(—Ö–æ–æ—Å–æ–Ω)")}</div>
      </div>
    `;
    resultsList.appendChild(item);
  }
}

// Init
renderQuestions();
updateProgress();
examDate.value = new Date().toISOString().slice(0,10);

questionsEl.addEventListener("change", updateProgress);
btnExam.addEventListener("click", showExam);

btnPoints.addEventListener("click", ()=>{
  const pin = prompt("–ë–∞–≥—à–∏–π–Ω –∫–æ–¥–æ–æ –æ—Ä—É—É–ª–Ω–∞ —É—É:");
  if(pin === null) return;
  if(String(pin).trim() !== EXAM.teacherPin){
    alert("–ö–æ–¥ –±—É—Ä—É—É –±–∞–π–Ω–∞!");
    return;
  }
  showPoints();
});

btnNew.addEventListener("click", ()=>{
  resetForm();
  showExam();
});

examForm.addEventListener("submit", (e)=>{
  e.preventDefault();
  const rec = saveAttempt();
  if(!rec) return;
  alert("–®–∞–ª–≥–∞–ª—Ç ”©–≥—Å”©–Ω–¥ –±–∞—è—Ä–ª–∞–ª–∞–∞. –•–∞—Ä–∏—É–≥ —Ö–∞–¥–≥–∞–ª–∂ –∞–≤–ª–∞–∞ ‚úÖ");
});
</script>
</body>
</html>
